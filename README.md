# PGN-2 SPEC

Specification: Portable Game Notation Version 2

Draft: 2020-05-09

Authors: Brian J. Wiborg


## 0: Preface

> You never change things by fighting the existing reality.
> To change something, build a new model that makes the existing model
> obsolete.  
    -- R. Buckminster Fuller


## 1: Introduction

PGN-2 is the "Portable Game Notation Version 2", the successor of the well
known and widely spread PGN format by *Steven J. Edwards* from 1994-03-12.

PGN-2 is a future compatible redesign of PGN. It follows the core design
principes of the legacy PGN specification but addresses various problems,
that have lead to several extended specifications and a rather broad spectrum
of subtle differences in the various implementations, as well es site-specific
customizations that grew out of necessity over the years.


## 2: Improvements over legacy PGN

The intention of this specification is to standardize a common data-exchange
format for chess games, that superseeds the legacy PGN specification, by:

1. being equally "easy to grasp", read and write by humans, as well as
   parsed and generated by computer programs
2. covering all features, including the various extensions of the
   specification, while maintaining the overall extensibility itself and
   continuing to allow for site-specific customizations
3. while being overall much easier to implement and leaving less room for
   subtle implementation differences.


### 2.1: Unicode Support

The encoding of PGN-2 data defaults to UTF-8. Importing ASCII encoded data is
supported, implicitly.


### 2.2: Structure and Tokenization

PGN-2 leverages [YAML](https://yaml.org/spec/) syntax for structure. YAML itself
is a superset of JSON, another very popular data-exchange format. Both formats
find overwhelming support in all popular languages. Consequentally, PGN-2
implementations can focus on validating and parsing the contents of the PGN-2
data, while delegating the deserialization of the byte-stream to YAML.

The root of each PGN-2 file is always a list, allowing for multiple ordered
games to be contained within a single file. Each PGN-2 file may contain
arbitrarily many games, while a file containing zero games is in fact
considered legal, despite being rather uninformative.

Each PGN-2 game is represented by a single list-item consisting of two
mandatory *(and case-sensitive)* keys:

- `tags` - containing the tags as key-value pairs *(known from legacy PGN)*
- `moves` - holding the ordered list of moves

It is considered legal to add arbitrarily many additional keys to a game. This
may be useful when implementing site-specific features.


### 2.3: Time Formats & Localization

PGN-2 requires all datetime fields to adhere to
[RFC-3339](https://tools.ietf.org/html/rfc3339). Timestamps should always
contain timezone information. Timestamps without timezone information should
be handled as if they where of timezone UTC. Implementations may display the
time information in their individual localtime.

Time-deltas are represented as integers or decimals *(floats)*. Their unit
always defaults to 'seconds'.

### 2.4: Example PGN-2 file containing the infamous F/S Return Match

```yaml
- tags:
    Event: "F/S Return Match"
    Site: "Belgrade, Serbia JUG"
    Date: "1992.11.04"
    Round: "29"
    White: "Fischer, Robert J."
    Black: "Spassky, Boris V."
    Result: "1/2-1/2"
  moves:
    - 'e4'
    - 'e5'
    - 'Nf3'
    - 'Nc6'
    - 'Bb5'
    - 'a6'
    # This opening is called the Ruy Lopez.
    - 'Ba4'
    - 'Nf6'
    - 'O-O'
    - 'Be7'
    - 'Re1'
    - 'b5'
    - 'Bb3'
    - 'd6'
    - 'c3'
    - 'O-O'
    - 'h3'
    - 'Nb8'
    - 'd4'
    - 'Nbd7'
    - 'c4'
    - 'c6'
    - 'cxb5
    - 'axb5'
    - 'Nc3'
    - 'Bb7'
    - 'Bg5'
    - 'b4'
    - 'Nb1'
    - 'h6'
    - 'Bh4'
    - 'c5'
    - 'dxe5'
    - 'Nxe4'
    - 'Bxe7'
    - 'Qxe7'
    - 'exd6'
    - 'Qf6'
    - 'Nbd2'
    - 'Nxd6'
    - 'Nc4'
    - 'Nxc4'
    - 'Bxc4'
    - 'Nb6'
    - 'Ne5'
    - 'Rae8'
    - 'Bxf7+'
    - 'Rxf7'
    - 'Nxf7'
    - 'Rxe1+'
    - 'Qxe1'
    - 'Kxf7'
    - 'Qe3'
    - 'Qg5'
    - 'Qxg5'
    - 'hxg5'
    - 'b3'
    - 'Ke6'
    - 'a3'
    - 'Kd6'
    - 'axb4'
    - 'cxb4'
    - 'Ra5'
    - 'Nd5'
    - 'f3'
    - 'Bc8'
    - 'Kf2'
    - 'Bf5'
    - 'Ra7'
    - 'g6'
    - 'Ra6+'
    - 'Kc5'
    - 'Ke1'
    - 'Nf4'
    - 'g3'
    - 'Nxh3'
    - 'Kd2'
    - 'Kb5'
    - 'Rd6'
    - 'Kc5'
    - 'Ra6'
    - 'Nf2'
    - 'g4'
    - 'Bd3'
    - 'Re6'
    - '1/2-1/2'
```

----


## 3: Move Metadata

Moves can be represented in two distinct forms. They can either be written as 
simple strings, or they can be represented as maps containing at least
a key of the name `move` holding the actual move as its string value.

Additional keys can then be be added for storing the metadata of each move.
Examples for well-known and commonly used metadata are:

- time-delta of the move
  *(i.e.: how long did the player take thinking about this move)*
- annotations
  *(e.g.: numeric annotation glyphs, bette move suggestions, etc)*
- variations
  *(i.e.: lines resulting from alternative moves)*


### 3.1: Example of a move containing metadata

```yaml
  - move: h6                # the actual move
    time: 4.2            # time-delta of move
    nag: 6                  # numeric annotation glyph
    annotation: custom...
    variations:
      - moves:
        - Nc6
        - d4
        - Qa5+
```
